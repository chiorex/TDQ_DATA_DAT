---
layout: math
title: 預かり所のバッファオーバーラン
update: 2017-05-28
---

ミシーナ離脱時に預かり所が一杯だと預かり所エリア外にアイテムが格納されるバグ

## メモリレイアウト

| No |          | 説明                      |
|:--:|:---------|:--------------------------|
|  - | BYTE[64] | 預かり所アイテムエリア    |
|  0 | BYTE     | 作戦(0～5)                |
|  1 | BYTE     | （未使用）                |
|  2 | BYTE     | PT人数１                  |
|  3 | BYTE     | （未使用）                |
|  4 | BYTE     | PT人数２                  |
|  5 | BYTE     | （未使用）                |
|  6 | BYTE     | PT人数３                  |
|  7 | BYTE     | （未使用）                |
|  8 | BYTE     | ルーラNo.24～31（未使用） |
|  9 | BYTE     | ルーラNo.16～23           |
| 10 | BYTE     | ルーラNo. 8～15           |
| 11 | BYTE     | ルーラNo. 0～ 7           |

### ルーラNo.16～23

| bit | 地名       |
|:---:|:-----------|
| $01 | カール     |
| $02 | ノースパタ |
| $04 | サースパタ |
| $08 | ローシ     |
| $10 | タルソプ   |
| $20 | ムームムリ |
| $40 | シカム     |
| $80 | カロシス   |


## 利用例

* 離脱時点に入手しやすいアイテムで構成
* アラキ加入前とする（PT人数の条件を明確にするため）
* 作戦はバグ適用後に手動で戻す

### ルーラ行き先を増やす

* シカム/タルソプ/サースパタ/カールがルーラ行き先に追加される

| No | ミシーナ所持品 | ID  | 説明                              |
|:--:|:---------------|:---:|:----------------------------------|
|  0 | 聖なるナイフ   | $04 | 作戦４：じゅもんつかわず          |
|  1 | 薬草           | $62 |                                   |
|  2 | こんぼう       | $02 | 主人公・チオレ                    |
|  3 | 薬草           | $62 |                                   |
|  4 | こんぼう       | $02 | 主人公・チオレ                    |
|  5 | 薬草           | $62 |                                   |
|  6 | こんぼう       | $02 | 主人公・チオレ                    |
|  7 | 薬草           | $62 |                                   |
|  8 | 薬草           | $62 |                                   |
|  9 | うろこの盾     | $55 | シカム/タルソプ/サースパタ/カール |

* うまくやれば中盤にアラキを連れ回せる（ただしルイーダ開放前のNPC状態）

### チオレを加入させない

| No | ミシーナ所持品 | ID  | 説明                              |
|:--:|:---------------|:---:|:----------------------------------|
|  0 | 聖なるナイフ   | $04 | 作戦４：じゅもんつかわず          |
|  1 | 薬草           | $62 |                                   |
|  2 | ひのきの棒     | $01 | 主人公のみ                        |
|  3 | 薬草           | $62 |                                   |
|  4 | ひのきの棒     | $01 | 主人公のみ                        |
|  5 | 薬草           | $62 |                                   |
|  6 | ひのきの棒     | $01 | 主人公のみ                        |
|  7 | （なし）       | -   |                                   |
|  8 | （なし）       | -   |                                   |
|  9 | （なし）       | -   |                                   |

* チオレはルイーダに待機しているのでいつでも加入できる
	* ルイーダ開放前の再離脱は可能だが困難

### ミシーナを残す

* シャウクと別れる直前にミシーナを隊列３番目にしておく必要あり

| No | ミシーナ所持品 | ID  | 説明                              |
|:--:|:---------------|:---:|:----------------------------------|
|  0 | 聖なるナイフ   | $04 | 作戦４：じゅもんつかわず          |
|  1 | 薬草           | $62 |                                   |
|  2 | 銅のつるぎ     | $03 | 主人公・チオレ・ミシーナ          |
|  3 | 薬草           | $62 |                                   |
|  4 | 銅のつるぎ     | $03 | 主人公・チオレ・ミシーナ          |
|  5 | 薬草           | $62 |                                   |
|  6 | 銅のつるぎ     | $03 | 主人公・チオレ・ミシーナ          |
|  7 | 薬草           | $62 |                                   |
|  8 | 薬草           | $62 |                                   |
|  9 | うろこの盾     | $55 | シカム/タルソプ/サースパタ/カール |

* ルイーダ開放されてもミシーナとは別れることができない（ツキミツまで）
* タルソプをルーラ行き先に追加しておくことで武術大会をスキップできる
	* うまくやればクリアまで持って行くことも可能（なはず）
	* フラグ不正で終盤にホルフに入るとフリーズする（はず）
